#A Philippe Cara
#D 190829
#T Logbook for my DXpedition branch of yfktest
#C I also have a fieldday branch which one day will be merged with this one
#C First things I had to do to get everything working is install curses etc on 
#  my Linux Peppermint 9... This is mainly what I put in this file. The rest is 
#  in git.

#C My ambition is to get at least the following things done. Many of them I have 
#  already done in the past.
# * DONE change operator with Alt+p. See readakey.pl and yfktest
# * DONE put a frequency on 60m for correct Cabrillo and ADIF output. See writelog.pl
# * DONE get QSO info broadcast over local network. See logqso.pl and yfktest
# * DONE: ESC key to stop sending CW (as alternative to Alt+x). See readakey.pl
# * In the orig-latest, I get Subroutine main::getchar redefined at subs/dxcc.pl 
#   line 2. Maybe have a look at this? This error has disappeared but I don't 
#   know why.
# * DONE: not for 6 seconds but until you press ALT-T again or ESC or ~/` or 
#   ALT-x. How about adding Alt-t to tune radio for 6 seconds (or less with ESC) 
#   (or until you press any key)? 
#   winkeyerdeamon has the command built in. Just send c with the number of 
#   seconds... NO the number of seconds is not honoured... C toggles tuning mode 
#   of the keyer. If you interrupt the keryer with '4', the tuning mode stays 
#   and sending 'c' will not tune but rather toggle the tune mode to off.
# * When starting yfktest reads the log and gives the red-background "status 
#   bar", then draws the logging window. The "status bar" stays on the screen. 
#   Maybe clear screen before drawing logging window?
# * DONE 191002: When you press F1, it now "runs" 
#   and keeps running until you press F1 again. In this mode, "ESC" stops 
#   sending but after cqinterval it starts again until you press F1 to stop it 
#   running. Next time 
#   you press F1,  it will again run. To go back to normal mode, prees ALT+E. 
#   Don't know if an  indication is needed for this mode. I don't think so. You 
#   see it when you press  F1. [FIXED 191002:Also When changing speed or typing 
#   backspace in 
#   Running mode, it seems that  the run stops after ending the current message. 
#   [191002 This was fixed by removing the lins with $oldtime = (time + 100)]]
#   While in running mode you can type calls, make QSOs, ... Once logged, the 
#   auto-CQ will resume. Neat feature!
#   If you change mode or band auto-CQ will stop. You must press F1 again to 
#   start running.
#   While programming this I discovered a net feature: to make QSO I usually 
#   press F5 (HISCALL), then F2 (EXCH). A shortcut for that is the 'INS'-key.
#   Maybe make a CQ repeat feature with ALT+E ? My Peppermint emphasizes the  
#   mouse pointer when you ALT+c :-( 
#
sudo apt install libcurses-perl
cd /mivies/HAM/yfktest
# The fieldday branch...
git clone git@bitbucket.org:pcara/nbttest.git 
# The DXpedition branch...
git clone git@bitbucket.org:pcara/yfktest-dx-pedition.git
# I have the original (as of 190829) branch in yfktest-orig-latest
# Later I will branch the official code and submit my addons

git commit -m "Fixed first line of yfktest to include -I ./ option so that subs can load."
# This is OK in orig-latest and was not needed in older PERL versions

# git asked me to configure it a bit...
git config --global user.email "pcara@vub.ac.be"
git config --global user.name "Philippe Cara"
git add yfktest
git commit -m "Fixed first line of yfktest to include -I ./ option so that subs can load."
git push
# To get the Fieldday branch going...
sudo apt install toilet
#Some tests...
while true; do echo "$(date '+%D %T' | toilet -f term -F border  --gay)"; sleep 1; done
#Also installed figlet for fun
sudo apt install figlet 
figlet Figlet!
watch -n1 "date '+%D%n%T'|figlet -k"
# Logged this for my Peppermint 9
loginst
toilet -f future 420

#Looking at how top open an UDP server
 grep cwsocket *
 nano yfktest 
 nano subs/logqso.pl 
 nano yfktest 
#I have a nice script to monitor UDP in another terminal 
cat monitorUDPport.txt 
./yfktest ../yfktest-orig-latest/DXpeditionMD.yfk 
git commit -m "tried to restore QSO broadcasting on port 12060"
git push
sudo tcpdump -i lo -n udp port 12060 -X

# ON4ACP 190830

git commit -m "Messed up everything with git. So started over with the 
original version of yfktest and will only add QSO broadcast and Operator change 
with Alt+p."

# Looking at ESC key
nano winkeyer.pl 
nano readakey.pl 
#In keyboardmode.pl it works!!
nano keyboardmode.pl 

./winkeydaemon.pl
# Could not open serial port... Forgot to install PERL module
sudo cpan install Device::SerialPort
./winkeydaemon.pl
#Still not working... No write permission for /dev/tttyUSB0
ls -l /dev/ttyUSB0 
#owner is root, group is dialout
id -Gn
#I am not member of dialout :-(
sudo adduser pcara dialout
./winkeydaemon.pl
#Still not working
id -Gn
#Not member of dialout?? You have to logout and login again for changes to take 
#effect!!

# ON4ACP 190831 commit did not stage my files
# probably because I changed several files and git rather lets you commit only
# files you want to. To commit a singel file, you first have to add it (again).
# to commit everything you can use git commit -a
pcara@latitude /movies/HAM/yfktest/yfktest-dx-pedition $ git commit -m "Now also 
key just under ESC on QWERTY aborts cw."
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
	modified:   logbook.txt
	modified:   subs/readakey.pl
	modified:   winkeydaemon.pl
	modified:   yfktest

Untracked files:
	DXPED.yfk
	subs/readakey.pl.phc

no changes added to commit
pcara@latitude /movies/HAM/yfktest/yfktest-dx-pedition $ git commit -am "<your 
message>"

190903 Finally got it working! Managed to log into N1MM+
Everything was fine but the bloody windows firewall (that I switched off 
on the LAN) was doing something nasty. I could see my UDP packets come 
in on WireShark but the were not picked up by N1MM+. Switching off the 
Firewall on the WAN solved the problem. Very strange but I now realize 
that Windows might mean "Windows network" (NetBIOS etc.) instead of LAN.

191023 Here is an e-mail I sent to Erik, ON4CCV, about N1MM
From: Philippe Cara <pcara@vub.ac.be>
To: "Erik Crabbe" <erik.crabbe@telenet.be>
Subject: Re: MD/OP2D
Date: Thu, 5 Sep 2019 21:28:21 +0200
X-Mailer: Claws Mail 3.8.0 (GTK+ 2.24.10; x86_64-pc-linux-gnu)
Organization: Vrije Universiteit Brussel

Hallo Erik,

ik vermoed dat je druk bezig bent met de velddag voorbereidingen.

Hoe zijn de tests met N1MM gelukt?

Ik kan nu zonder probleem de QSOs die ik log ook real-time in N1MM
laten verschijnen. Als ik morgen even Samantha's computer mag gebruiken
stuur ik jou een demo.

Uiteindelijk is de oplossing heel simpel maar ik heb heel het weekend
gedacht dat het niet werkte omdat ik dacht dat Windows met "local home
network" LAN bedoelde. Dat blijkt niet zo te zijn (ze bedoelen hiermee
\\WORKGROUP denk ik). De WAN firewall hield dus mijn QSOs de hele tijd
tegen (hoewel ik ze kon zien aankomen op de computer).

VRAAG 1: ik neem aan dat het netwerk ginds IP adressen gaat toekennen
via DHCP. Correct? Of werk je met vaste adressen?

Het systeem dat ik gebruik gaat niet via poort 12060. Dat is een poort
waarop N1MM zelf QSOs verzendt (in een eigen XML formaat via UDP). N1MM
luistert niet standaard op deze poort (heb ik ontdekt). Ik vermoed dat
hij enkel luistert als hij eerst met een andere kopij van N1MM kan
communiceren op 12070. Het juiste formaat hiervan ken ik niet want
wordt geheim gehouden en ik heb geen twee windows computers om te
kijken hoe ze interageren. Ik zie wel dat N1MM om de 20 seconden een
UDP pakket stuurt op 12070.

Wat wel werkt is poort 2333 die in N1MM ingebouwd is om juist QSO
informatie uit andere programma's te krijgen, in ADIF. Dat was met twee
lijnen in het programma geklonken (maar de firewall...).

De documentatie geeft enkel een voorbeeld om een QSO naar de log te
sturen, met "<COMMAND:3>Log". Ik vermoed dat er ook een mogelijkheid is
om een QSO te deleten of te corrigeren maar wegens documentatie- en
tijdgebrek om het zelf te achterhalen zal dit voor een volgende versie
zijn. Ik denk niet dat wij heel veel fouten corrigeren tijdens de
DXpeditie. De enige die ik mij herinner is ON6MAB -> ON6QB ;-) En we
kunnen altijd correcties maken in N1MM zelf.

VRAAG 2: Wat denk jij?

VRAAG 3: Hoe zit het met de integratie van WSJT-X (voor FT8) in N1MM+.
De oude manier om dat te doen gaat namelijk ook via poort 2333. Ik
weet niet of je in N1MM twee adressen kan instellen waar N1MM naar
luistert voor QSOs maar ik vermoed van wel. Dan zet je gewoon 127.0.0.1
en <IP-CW-STATION>. Anders moeten we op sommige momenten
herconfigureren. De modernere manier om WSJT-X te doen is poort 2237.
Dan zijn er geen poortconflicten maar mijn korte tijd op de N1MM
mailing list toont dat dat allemaal niet vanzelf gaat... (het is een
zeer drukke mailing list. N1MM is zo complex dat er veel hulp nodig is
om de doorsnee amateur te laten genieten van "the best contest logger
ever made").

VRAAG 4: zal ik ook stellen aan Martin. Als ik QSOs injecteer in de
master N1MM, die ook in gebruik is als log van een van onze stations,
weet ik niet goed wat QSO Director gaat doen. Ik herinner mij dat we
moesten zeggen welke stations (via NetBIOS naam) door N1MM moesten
gevolgd worden. Ik heb natuurlijk geen NetBIOS naam omdat ik geen
Windows heb. Ik kan ook geen stationsnaam sturen in ADIF (tenzij het
wel kan maar niet gedocumenteerd is). Dus denk ik dat mijn QSOs zullen
gelogd worden onder de NetBIOS naam van de master computer (MARNIK-PC).
Ik heb daar geen enkel probleem mee maar QSO Director zou wel eens rare
resultaten kunnen geven, waarbij op de website de roepnaam van de
operator, de mode en de band op MARNIK-PC om de 5 seconden verspringt
(naargelang een QSO wordt gemaakt in CW of op het station van
MARNIK-PC). Op zich zeker niet hinderlijk maar kan verwarrend zijn voor
bezoekers voor de website. Ik zal Martin vragen of wij hem eventueel
via een ander ADIF veld (zoals <COMMENT:>) kunnen laten weten van welk
station een QSO komt.

Tijdens mijn experimenten kwam ik tot de vaststelling dat N1MM heel
veel niet-gedocumenteerde dingen doet op het netwerk. Als ik eens twee
windows computers te pakken krijg, zal ik hun systeem wel eens
reverse-engineeren en een nog betere oplossing maken.

Beste 73 en fijne avond,

Philippe

On 190905 at 15:25, Erik Crabbe wrote:
> baja , we moeten ambitieus zijn, nietwaar ;-)
> 
> oei, waarom heb je commentaar gekregen van N1MM?   
> 
> cu ! - 73
> erik 
> 
> -----Original Message-----
> From: Philippe Cara 
> Sent: Thursday, September 5, 2019 11:40
> To: ON4ANN <on4ann@gmail.com>
> Cc: Erik Crabbe <erik.crabbe@telenet.be>; ON5CD@telenet.be;
> walter.croes@telenet.be; rudi.carael@gmail.com; on4dcu@gmail.com;
> mertens_luc@telenet.be; Etienne <etienne.vandenbroeck@telenet.be>;
> cedric@baelemans.com; on4dto@hotmail.com Subject: Re: MD/OP2D
> 
> On 190904 at 21:19, ON4ANN wrote:  
> > Nu de poll : voor hoeveel qsoâ€™s gaan we ?  
> 
> Toen we QSO Director aan het configureren waren zei Erik: 50000 ;-)
> Per dag...
> 
> 73,
> 
> Philippe
> 
> PS: netwerk logging tussen mijn laptop en N1MM+ is bijna in orde,
> ondanks de niet heel sympathieke commentaren van N1MM himself;-)
>   

191024 Erik's answer:

From: "Erik Crabbe" <erik.crabbe@telenet.be>
To: "'Philippe Cara'" <pcara@vub.ac.be>
Subject: RE: MD/OP2D
Date: Thu, 5 Sep 2019 23:20:46 +0200
X-Mailer: Microsoft Outlook 16.0

hoi Philippe

antwoorden hieronder

 

73!

erik

 

-----Original Message-----
From: Philippe Cara 
Sent: Thursday, September 5, 2019 21:28
To: Erik Crabbe <erik.crabbe@telenet.be>
Subject: Re: MD/OP2D

 

Hallo Erik,

 

ik vermoed dat je druk bezig bent met de velddag voorbereidingen.

 

Hoe zijn de tests met N1MM gelukt? Deze week nog niet aan toe gekomen - zal voor 
volgende week zijn (na de velddag)

 

Ik kan nu zonder probleem de QSOs die ik log ook real-time in N1MM laten 
verschijnen. Als ik morgen even Samantha's computer mag gebruiken stuur ik jou 
een demo.

 

Uiteindelijk is de oplossing heel simpel maar ik heb heel het weekend gedacht 
dat het niet werkte omdat ik dacht dat Windows met "local home network" LAN 
bedoelde. Dat blijkt niet zo te zijn (ze bedoelen hiermee  <file://WORKGROUP> 
\\WORKGROUP denk ik). De WAN firewall hield dus mijn QSOs de hele tijd tegen 
(hoewel ik ze kon zien aankomen op de computer).

 

VRAAG 1: ik neem aan dat het netwerk ginds IP adressen gaat toekennen via DHCP. 
Correct? Of werk je met vaste adressen?  IP toekenning zal idd via DHCP gaan, 
static adressen mag, maar hoeft niet (N1MM kan dat aan). Enige voorwaarde: alle 
log stations moeten in hetzelfde subnet zitten

 

Het systeem dat ik gebruik gaat niet via poort 12060. Dat is een poort waarop 
N1MM zelf QSOs verzendt (in een eigen XML formaat via UDP). N1MM luistert niet 
standaard op deze poort (heb ik ontdekt). Ik vermoed dat hij enkel luistert als 
hij eerst met een andere kopij van N1MM kan communiceren op 12070. Het juiste 
formaat hiervan ken ik niet want wordt geheim gehouden en ik heb geen twee 
windows computers om te kijken hoe ze interageren. Ik zie wel dat N1MM om de 20 
seconden een UDP pakket stuurt op 12070.

 

Wat wel werkt is poort 2333 die in N1MM ingebouwd is om juist QSO informatie uit 
andere programma's te krijgen, in ADIF. Dat was met twee lijnen in het programma 
geklonken (maar de firewall...).

 

De documentatie geeft enkel een voorbeeld om een QSO naar de log te sturen, met 
"<COMMAND:3>Log". Ik vermoed dat er ook een mogelijkheid is om een QSO te 
deleten of te corrigeren maar wegens documentatie- en tijdgebrek om het zelf te 
achterhalen zal dit voor een volgende versie zijn. Ik denk niet dat wij heel 
veel fouten corrigeren tijdens de DXpeditie. De enige die ik mij herinner is 
ON6MAB -> ON6QB ;-) En we kunnen altijd correcties maken in N1MM zelf.

 

VRAAG 2: Wat denk jij?  Idd als er correcties nodig zijn gaan we dat achteraf in 
N1MM of in de ADIF log moeten doen (alvorens te uploaden  naar clublog)

 

VRAAG 3: Hoe zit het met de integratie van WSJT-X (voor FT8) in N1MM+.  die 
integratie werkt - ik heb het alleszins al werkend gekregen (is al ff geleden) ,  
zal het nog eens testen volgende week; dit zou de instelling moeten zijn in de 
Settings > Reporting tab van N1MM  (maar dat heb je allicht al lang gevonden :-)  
Ik heb nog niet geexperimenteerd met een ander port number (2237?). En waar stel 
je dat dan in op WSJT-X?



De oude manier om dat te doen gaat namelijk ook via poort 2333. Ik weet niet of 
je in N1MM twee adressen kan instellen waar N1MM naar luistert voor QSOs maar ik 
vermoed van wel. Dan zet je gewoon 127.0.0.1 en <IP-CW-STATION>. Anders moeten 
we op sommige momenten herconfigureren. De modernere manier om WSJT-X te doen is 
poort 2237.

Dan zijn er geen poortconflicten maar mijn korte tijd op de N1MM mailing list 
toont dat dat allemaal niet vanzelf gaat... (het is een zeer drukke mailing 
list. N1MM is zo complex dat er veel hulp nodig is om de doorsnee amateur te 
laten genieten van "the best contest logger ever made").

 

VRAAG 4: zal ik ook stellen aan Martin. Als ik QSOs injecteer in de master N1MM, 
die ook in gebruik is als log van een van onze stations, weet ik niet goed wat 
QSO Director gaat doen. Ik herinner mij dat we moesten zeggen welke stations 
(via NetBIOS naam) door N1MM moesten gevolgd worden. Ik heb natuurlijk geen 
NetBIOS naam omdat ik geen Windows heb. Ik kan ook geen stationsnaam sturen in 
ADIF (tenzij het wel kan maar niet gedocumenteerd is). Dus denk ik dat mijn QSOs 
zullen gelogd worden onder de NetBIOS naam van de master computer (MARNIK-PC).

Ik heb daar geen enkel probleem mee maar QSO Director zou wel eens rare 
resultaten kunnen geven, waarbij op de website de roepnaam van de operator, de 
mode en de band op MARNIK-PC om de 5 seconden verspringt (naargelang een QSO 
wordt gemaakt in CW of op het station van MARNIK-PC). Op zich zeker niet 
hinderlijk maar kan verwarrend zijn voor bezoekers voor de website. Ik zal 
Martin vragen of wij hem eventueel via een ander ADIF veld (zoals <COMMENT:>) 
kunnen laten weten van welk station een QSO komt. Dat weet ik ook niet; ik denk 
dat het de log info van de "geconsolideerde" log op het N1MM Master station is 
die door QSODirector wordt opgepikt;  de bijkomende info (op name, netbios name, 
...) van elk netwerk station wordt dan apart doorgestuurd? 

 

Tijdens mijn experimenten kwam ik tot de vaststelling dat N1MM heel veel 
niet-gedocumenteerde dingen doet op het netwerk. Als ik eens twee windows 
computers te pakken krijg, zal ik hun systeem wel eens reverse-engineeren en een 
nog betere oplossing maken.  Feel free ;-)   we gaan ginder wel wat tijd hebben 
om daarmee te prullen ...

 

Beste 73 en fijne avond,

 

Philippe

191024 After the MD/OP2D expedition I found out (somewhere on internet, can't 
find it back) that N1MM+ actually has a "network debugging" menu or window 
somewhere. This should show all N1MM+ traffic. Would have helped a lot to 
actually understand what N1MM+ all does on the network.
